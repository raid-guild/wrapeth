{"ast":null,"code":"/* jshint node: true */\n\"use strict\";\n\nfunction makeArrayFrom(obj) {\n  return Array.prototype.slice.apply(obj);\n}\n\nvar PENDING = \"pending\",\n    RESOLVED = \"resolved\",\n    REJECTED = \"rejected\";\n\nfunction SynchronousPromise(handler) {\n  this.status = PENDING;\n  this._continuations = [];\n  this._parent = null;\n  this._paused = false;\n\n  if (handler) {\n    handler.call(this, this._continueWith.bind(this), this._failWith.bind(this));\n  }\n}\n\nfunction looksLikeAPromise(obj) {\n  return obj && typeof obj.then === \"function\";\n}\n\nSynchronousPromise.prototype = {\n  then: function (nextFn, catchFn) {\n    var next = SynchronousPromise.unresolved()._setParent(this);\n\n    if (this._isRejected()) {\n      if (this._paused) {\n        this._continuations.push({\n          promise: next,\n          nextFn: nextFn,\n          catchFn: catchFn\n        });\n\n        return next;\n      }\n\n      if (catchFn) {\n        try {\n          var catchResult = catchFn(this._error);\n\n          if (looksLikeAPromise(catchResult)) {\n            this._chainPromiseData(catchResult, next);\n\n            return next;\n          } else {\n            return SynchronousPromise.resolve(catchResult)._setParent(this);\n          }\n        } catch (e) {\n          return SynchronousPromise.reject(e)._setParent(this);\n        }\n      }\n\n      return SynchronousPromise.reject(this._error)._setParent(this);\n    }\n\n    this._continuations.push({\n      promise: next,\n      nextFn: nextFn,\n      catchFn: catchFn\n    });\n\n    this._runResolutions();\n\n    return next;\n  },\n  catch: function (handler) {\n    if (this._isResolved()) {\n      return SynchronousPromise.resolve(this._data)._setParent(this);\n    }\n\n    var next = SynchronousPromise.unresolved()._setParent(this);\n\n    this._continuations.push({\n      promise: next,\n      catchFn: handler\n    });\n\n    this._runRejections();\n\n    return next;\n  },\n  finally: function (callback) {\n    var ran = false;\n\n    function runFinally() {\n      if (!ran) {\n        ran = true;\n        return callback();\n      }\n    }\n\n    return this.then(runFinally).catch(runFinally);\n  },\n  pause: function () {\n    this._paused = true;\n    return this;\n  },\n  resume: function () {\n    var firstPaused = this._findFirstPaused();\n\n    if (firstPaused) {\n      firstPaused._paused = false;\n\n      firstPaused._runResolutions();\n\n      firstPaused._runRejections();\n    }\n\n    return this;\n  },\n  _findAncestry: function () {\n    return this._continuations.reduce(function (acc, cur) {\n      if (cur.promise) {\n        var node = {\n          promise: cur.promise,\n          children: cur.promise._findAncestry()\n        };\n        acc.push(node);\n      }\n\n      return acc;\n    }, []);\n  },\n  _setParent: function (parent) {\n    if (this._parent) {\n      throw new Error(\"parent already set\");\n    }\n\n    this._parent = parent;\n    return this;\n  },\n  _continueWith: function (data) {\n    var firstPending = this._findFirstPending();\n\n    if (firstPending) {\n      firstPending._data = data;\n\n      firstPending._setResolved();\n    }\n  },\n  _findFirstPending: function () {\n    return this._findFirstAncestor(function (test) {\n      return test._isPending && test._isPending();\n    });\n  },\n  _findFirstPaused: function () {\n    return this._findFirstAncestor(function (test) {\n      return test._paused;\n    });\n  },\n  _findFirstAncestor: function (matching) {\n    var test = this;\n    var result;\n\n    while (test) {\n      if (matching(test)) {\n        result = test;\n      }\n\n      test = test._parent;\n    }\n\n    return result;\n  },\n  _failWith: function (error) {\n    var firstRejected = this._findFirstPending();\n\n    if (firstRejected) {\n      firstRejected._error = error;\n\n      firstRejected._setRejected();\n    }\n  },\n  _takeContinuations: function () {\n    return this._continuations.splice(0, this._continuations.length);\n  },\n  _runRejections: function () {\n    if (this._paused || !this._isRejected()) {\n      return;\n    }\n\n    var error = this._error,\n        continuations = this._takeContinuations(),\n        self = this;\n\n    continuations.forEach(function (cont) {\n      if (cont.catchFn) {\n        try {\n          var catchResult = cont.catchFn(error);\n\n          self._handleUserFunctionResult(catchResult, cont.promise);\n        } catch (e) {\n          var message = e.message;\n          cont.promise.reject(e);\n        }\n      } else {\n        cont.promise.reject(error);\n      }\n    });\n  },\n  _runResolutions: function () {\n    if (this._paused || !this._isResolved() || this._isPending()) {\n      return;\n    }\n\n    var continuations = this._takeContinuations();\n\n    if (looksLikeAPromise(this._data)) {\n      return this._handleWhenResolvedDataIsPromise(this._data);\n    }\n\n    var data = this._data;\n    var self = this;\n    continuations.forEach(function (cont) {\n      if (cont.nextFn) {\n        try {\n          var result = cont.nextFn(data);\n\n          self._handleUserFunctionResult(result, cont.promise);\n        } catch (e) {\n          self._handleResolutionError(e, cont);\n        }\n      } else if (cont.promise) {\n        cont.promise.resolve(data);\n      }\n    });\n  },\n  _handleResolutionError: function (e, continuation) {\n    this._setRejected();\n\n    if (continuation.catchFn) {\n      try {\n        continuation.catchFn(e);\n        return;\n      } catch (e2) {\n        e = e2;\n      }\n    }\n\n    if (continuation.promise) {\n      continuation.promise.reject(e);\n    }\n  },\n  _handleWhenResolvedDataIsPromise: function (data) {\n    var self = this;\n    return data.then(function (result) {\n      self._data = result;\n\n      self._runResolutions();\n    }).catch(function (error) {\n      self._error = error;\n\n      self._setRejected();\n\n      self._runRejections();\n    });\n  },\n  _handleUserFunctionResult: function (data, nextSynchronousPromise) {\n    if (looksLikeAPromise(data)) {\n      this._chainPromiseData(data, nextSynchronousPromise);\n    } else {\n      nextSynchronousPromise.resolve(data);\n    }\n  },\n  _chainPromiseData: function (promiseData, nextSynchronousPromise) {\n    promiseData.then(function (newData) {\n      nextSynchronousPromise.resolve(newData);\n    }).catch(function (newError) {\n      nextSynchronousPromise.reject(newError);\n    });\n  },\n  _setResolved: function () {\n    this.status = RESOLVED;\n\n    if (!this._paused) {\n      this._runResolutions();\n    }\n  },\n  _setRejected: function () {\n    this.status = REJECTED;\n\n    if (!this._paused) {\n      this._runRejections();\n    }\n  },\n  _isPending: function () {\n    return this.status === PENDING;\n  },\n  _isResolved: function () {\n    return this.status === RESOLVED;\n  },\n  _isRejected: function () {\n    return this.status === REJECTED;\n  }\n};\n\nSynchronousPromise.resolve = function (result) {\n  return new SynchronousPromise(function (resolve, reject) {\n    if (looksLikeAPromise(result)) {\n      result.then(function (newResult) {\n        resolve(newResult);\n      }).catch(function (error) {\n        reject(error);\n      });\n    } else {\n      resolve(result);\n    }\n  });\n};\n\nSynchronousPromise.reject = function (result) {\n  return new SynchronousPromise(function (resolve, reject) {\n    reject(result);\n  });\n};\n\nSynchronousPromise.unresolved = function () {\n  return new SynchronousPromise(function (resolve, reject) {\n    this.resolve = resolve;\n    this.reject = reject;\n  });\n};\n\nSynchronousPromise.all = function () {\n  var args = makeArrayFrom(arguments);\n\n  if (Array.isArray(args[0])) {\n    args = args[0];\n  }\n\n  if (!args.length) {\n    return SynchronousPromise.resolve([]);\n  }\n\n  return new SynchronousPromise(function (resolve, reject) {\n    var allData = [],\n        numResolved = 0,\n        doResolve = function () {\n      if (numResolved === args.length) {\n        resolve(allData);\n      }\n    },\n        rejected = false,\n        doReject = function (err) {\n      if (rejected) {\n        return;\n      }\n\n      rejected = true;\n      reject(err);\n    };\n\n    args.forEach(function (arg, idx) {\n      SynchronousPromise.resolve(arg).then(function (thisResult) {\n        allData[idx] = thisResult;\n        numResolved += 1;\n        doResolve();\n      }).catch(function (err) {\n        doReject(err);\n      });\n    });\n  });\n};\n/* jshint ignore:start */\n\n\nif (Promise === SynchronousPromise) {\n  throw new Error(\"Please use SynchronousPromise.installGlobally() to install globally\");\n}\n\nvar RealPromise = Promise;\n\nSynchronousPromise.installGlobally = function (__awaiter) {\n  if (Promise === SynchronousPromise) {\n    return __awaiter;\n  }\n\n  var result = patchAwaiterIfRequired(__awaiter);\n  Promise = SynchronousPromise;\n  return result;\n};\n\nSynchronousPromise.uninstallGlobally = function () {\n  if (Promise === SynchronousPromise) {\n    Promise = RealPromise;\n  }\n};\n\nfunction patchAwaiterIfRequired(__awaiter) {\n  if (typeof __awaiter === \"undefined\" || __awaiter.__patched) {\n    return __awaiter;\n  }\n\n  var originalAwaiter = __awaiter;\n\n  __awaiter = function () {\n    var Promise = RealPromise;\n    originalAwaiter.apply(this, makeArrayFrom(arguments));\n  };\n\n  __awaiter.__patched = true;\n  return __awaiter;\n}\n/* jshint ignore:end */\n\n\nmodule.exports = {\n  SynchronousPromise: SynchronousPromise\n};","map":{"version":3,"sources":["/Users/vengist/environments/raid/wethwrapper-web/node_modules/synchronous-promise/index.js"],"names":["makeArrayFrom","obj","Array","prototype","slice","apply","PENDING","RESOLVED","REJECTED","SynchronousPromise","handler","status","_continuations","_parent","_paused","call","_continueWith","bind","_failWith","looksLikeAPromise","then","nextFn","catchFn","next","unresolved","_setParent","_isRejected","push","promise","catchResult","_error","_chainPromiseData","resolve","e","reject","_runResolutions","catch","_isResolved","_data","_runRejections","finally","callback","ran","runFinally","pause","resume","firstPaused","_findFirstPaused","_findAncestry","reduce","acc","cur","node","children","parent","Error","data","firstPending","_findFirstPending","_setResolved","_findFirstAncestor","test","_isPending","matching","result","error","firstRejected","_setRejected","_takeContinuations","splice","length","continuations","self","forEach","cont","_handleUserFunctionResult","message","_handleWhenResolvedDataIsPromise","_handleResolutionError","continuation","e2","nextSynchronousPromise","promiseData","newData","newError","newResult","all","args","arguments","isArray","allData","numResolved","doResolve","rejected","doReject","err","arg","idx","thisResult","Promise","RealPromise","installGlobally","__awaiter","patchAwaiterIfRequired","uninstallGlobally","__patched","originalAwaiter","module","exports"],"mappings":"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","sourcesContent":["/* jshint node: true */\r\n\"use strict\";\r\nfunction makeArrayFrom(obj) {\r\n  return Array.prototype.slice.apply(obj);\r\n}\r\nvar\r\n  PENDING = \"pending\",\r\n  RESOLVED = \"resolved\",\r\n  REJECTED = \"rejected\";\r\n\r\nfunction SynchronousPromise(handler) {\r\n  this.status = PENDING;\r\n  this._continuations = [];\r\n  this._parent = null;\r\n  this._paused = false;\r\n  if (handler) {\r\n    handler.call(\r\n      this,\r\n      this._continueWith.bind(this),\r\n      this._failWith.bind(this)\r\n    );\r\n  }\r\n}\r\n\r\nfunction looksLikeAPromise(obj) {\r\n  return obj && typeof (obj.then) === \"function\";\r\n}\r\n\r\nSynchronousPromise.prototype = {\r\n  then: function (nextFn, catchFn) {\r\n    var next = SynchronousPromise.unresolved()._setParent(this);\r\n    if (this._isRejected()) {\r\n      if (this._paused) {\r\n        this._continuations.push({\r\n          promise: next,\r\n          nextFn: nextFn,\r\n          catchFn: catchFn\r\n        });\r\n        return next;\r\n      }\r\n      if (catchFn) {\r\n        try {\r\n          var catchResult = catchFn(this._error);\r\n          if (looksLikeAPromise(catchResult)) {\r\n            this._chainPromiseData(catchResult, next);\r\n            return next;\r\n          } else {\r\n            return SynchronousPromise.resolve(catchResult)._setParent(this);\r\n          }\r\n        } catch (e) {\r\n          return SynchronousPromise.reject(e)._setParent(this);\r\n        }\r\n      }\r\n      return SynchronousPromise.reject(this._error)._setParent(this);\r\n    }\r\n    this._continuations.push({\r\n      promise: next,\r\n      nextFn: nextFn,\r\n      catchFn: catchFn\r\n    });\r\n    this._runResolutions();\r\n    return next;\r\n  },\r\n  catch: function (handler) {\r\n    if (this._isResolved()) {\r\n      return SynchronousPromise.resolve(this._data)._setParent(this);\r\n    }\r\n    var next = SynchronousPromise.unresolved()._setParent(this);\r\n    this._continuations.push({\r\n      promise: next,\r\n      catchFn: handler\r\n    });\r\n    this._runRejections();\r\n    return next;\r\n  },\r\n  finally: function(callback) {\r\n    var ran = false;\r\n    function runFinally() {\r\n      if (!ran) {\r\n        ran = true;\r\n        return callback();\r\n      }\r\n    }\r\n    return this.then(runFinally)\r\n      .catch(runFinally);\r\n  },\r\n  pause: function () {\r\n    this._paused = true;\r\n    return this;\r\n  },\r\n  resume: function () {\r\n    var firstPaused = this._findFirstPaused();\r\n    if (firstPaused) {\r\n      firstPaused._paused = false;\r\n      firstPaused._runResolutions();\r\n      firstPaused._runRejections();\r\n    }\r\n    return this;\r\n  },\r\n  _findAncestry: function () {\r\n    return this._continuations.reduce(function (acc, cur) {\r\n      if (cur.promise) {\r\n        var node = {\r\n          promise: cur.promise,\r\n          children: cur.promise._findAncestry()\r\n        };\r\n        acc.push(node);\r\n      }\r\n      return acc;\r\n    }, []);\r\n  },\r\n  _setParent: function (parent) {\r\n    if (this._parent) {\r\n      throw new Error(\"parent already set\");\r\n    }\r\n    this._parent = parent;\r\n    return this;\r\n  },\r\n  _continueWith: function (data) {\r\n    var firstPending = this._findFirstPending();\r\n    if (firstPending) {\r\n      firstPending._data = data;\r\n      firstPending._setResolved();\r\n    }\r\n  },\r\n  _findFirstPending: function () {\r\n    return this._findFirstAncestor(function (test) {\r\n      return test._isPending && test._isPending();\r\n    });\r\n  },\r\n  _findFirstPaused: function () {\r\n    return this._findFirstAncestor(function (test) {\r\n      return test._paused;\r\n    });\r\n  },\r\n  _findFirstAncestor: function (matching) {\r\n    var test = this;\r\n    var result;\r\n    while (test) {\r\n      if (matching(test)) {\r\n        result = test;\r\n      }\r\n      test = test._parent;\r\n    }\r\n    return result;\r\n  },\r\n  _failWith: function (error) {\r\n    var firstRejected = this._findFirstPending();\r\n    if (firstRejected) {\r\n      firstRejected._error = error;\r\n      firstRejected._setRejected();\r\n    }\r\n  },\r\n  _takeContinuations: function () {\r\n    return this._continuations.splice(0, this._continuations.length);\r\n  },\r\n  _runRejections: function () {\r\n    if (this._paused || !this._isRejected()) {\r\n      return;\r\n    }\r\n    var\r\n      error = this._error,\r\n      continuations = this._takeContinuations(),\r\n      self = this;\r\n    continuations.forEach(function (cont) {\r\n      if (cont.catchFn) {\r\n        try {\r\n          var catchResult = cont.catchFn(error);\r\n          self._handleUserFunctionResult(catchResult, cont.promise);\r\n        } catch (e) {\r\n          var message = e.message;\r\n          cont.promise.reject(e);\r\n        }\r\n      } else {\r\n        cont.promise.reject(error);\r\n      }\r\n    });\r\n  },\r\n  _runResolutions: function () {\r\n    if (this._paused || !this._isResolved() || this._isPending()) {\r\n      return;\r\n    }\r\n    var continuations = this._takeContinuations();\r\n    if (looksLikeAPromise(this._data)) {\r\n      return this._handleWhenResolvedDataIsPromise(this._data);\r\n    }\r\n    var data = this._data;\r\n    var self = this;\r\n    continuations.forEach(function (cont) {\r\n      if (cont.nextFn) {\r\n        try {\r\n          var result = cont.nextFn(data);\r\n          self._handleUserFunctionResult(result, cont.promise);\r\n        } catch (e) {\r\n          self._handleResolutionError(e, cont);\r\n        }\r\n      } else if (cont.promise) {\r\n        cont.promise.resolve(data);\r\n      }\r\n    });\r\n  },\r\n  _handleResolutionError: function (e, continuation) {\r\n    this._setRejected();\r\n    if (continuation.catchFn) {\r\n      try {\r\n        continuation.catchFn(e);\r\n        return;\r\n      } catch (e2) {\r\n        e = e2;\r\n      }\r\n    }\r\n    if (continuation.promise) {\r\n      continuation.promise.reject(e);\r\n    }\r\n  },\r\n  _handleWhenResolvedDataIsPromise: function (data) {\r\n    var self = this;\r\n    return data.then(function (result) {\r\n      self._data = result;\r\n      self._runResolutions();\r\n    }).catch(function (error) {\r\n      self._error = error;\r\n      self._setRejected();\r\n      self._runRejections();\r\n    });\r\n  },\r\n  _handleUserFunctionResult: function (data, nextSynchronousPromise) {\r\n    if (looksLikeAPromise(data)) {\r\n      this._chainPromiseData(data, nextSynchronousPromise);\r\n    } else {\r\n      nextSynchronousPromise.resolve(data);\r\n    }\r\n  },\r\n  _chainPromiseData: function (promiseData, nextSynchronousPromise) {\r\n    promiseData.then(function (newData) {\r\n      nextSynchronousPromise.resolve(newData);\r\n    }).catch(function (newError) {\r\n      nextSynchronousPromise.reject(newError);\r\n    });\r\n  },\r\n  _setResolved: function () {\r\n    this.status = RESOLVED;\r\n    if (!this._paused) {\r\n      this._runResolutions();\r\n    }\r\n  },\r\n  _setRejected: function () {\r\n    this.status = REJECTED;\r\n    if (!this._paused) {\r\n      this._runRejections();\r\n    }\r\n  },\r\n  _isPending: function () {\r\n    return this.status === PENDING;\r\n  },\r\n  _isResolved: function () {\r\n    return this.status === RESOLVED;\r\n  },\r\n  _isRejected: function () {\r\n    return this.status === REJECTED;\r\n  }\r\n};\r\n\r\nSynchronousPromise.resolve = function (result) {\r\n  return new SynchronousPromise(function (resolve, reject) {\r\n    if (looksLikeAPromise(result)) {\r\n      result.then(function (newResult) {\r\n        resolve(newResult);\r\n      }).catch(function (error) {\r\n        reject(error);\r\n      });\r\n    } else {\r\n      resolve(result);\r\n    }\r\n  });\r\n};\r\n\r\nSynchronousPromise.reject = function (result) {\r\n  return new SynchronousPromise(function (resolve, reject) {\r\n    reject(result);\r\n  });\r\n};\r\n\r\nSynchronousPromise.unresolved = function () {\r\n  return new SynchronousPromise(function (resolve, reject) {\r\n    this.resolve = resolve;\r\n    this.reject = reject;\r\n  });\r\n};\r\n\r\nSynchronousPromise.all = function () {\r\n  var args = makeArrayFrom(arguments);\r\n  if (Array.isArray(args[0])) {\r\n    args = args[0];\r\n  }\r\n  if (!args.length) {\r\n    return SynchronousPromise.resolve([]);\r\n  }\r\n  return new SynchronousPromise(function (resolve, reject) {\r\n    var\r\n      allData = [],\r\n      numResolved = 0,\r\n      doResolve = function () {\r\n        if (numResolved === args.length) {\r\n          resolve(allData);\r\n        }\r\n      },\r\n      rejected = false,\r\n      doReject = function (err) {\r\n        if (rejected) {\r\n          return;\r\n        }\r\n        rejected = true;\r\n        reject(err);\r\n      };\r\n    args.forEach(function (arg, idx) {\r\n      SynchronousPromise.resolve(arg).then(function (thisResult) {\r\n        allData[idx] = thisResult;\r\n        numResolved += 1;\r\n        doResolve();\r\n      }).catch(function (err) {\r\n        doReject(err);\r\n      });\r\n    });\r\n  });\r\n};\r\n\r\n/* jshint ignore:start */\r\nif (Promise === SynchronousPromise) {\r\n  throw new Error(\"Please use SynchronousPromise.installGlobally() to install globally\");\r\n}\r\nvar RealPromise = Promise;\r\nSynchronousPromise.installGlobally = function(__awaiter) {\r\n  if (Promise === SynchronousPromise) {\r\n    return __awaiter;\r\n  }\r\n  var result = patchAwaiterIfRequired(__awaiter);\r\n  Promise = SynchronousPromise;\r\n  return result;\r\n};\r\n\r\nSynchronousPromise.uninstallGlobally = function() {\r\n  if (Promise === SynchronousPromise) {\r\n    Promise = RealPromise;\r\n  }\r\n};\r\n\r\nfunction patchAwaiterIfRequired(__awaiter) {\r\n  if (typeof(__awaiter) === \"undefined\" || __awaiter.__patched) {\r\n    return __awaiter;\r\n  }\r\n  var originalAwaiter = __awaiter;\r\n  __awaiter = function() {\r\n    var Promise = RealPromise;\r\n    originalAwaiter.apply(this, makeArrayFrom(arguments));\r\n  };\r\n  __awaiter.__patched = true;\r\n  return __awaiter;\r\n}\r\n/* jshint ignore:end */\r\n\r\nmodule.exports = {\r\n  SynchronousPromise: SynchronousPromise\r\n};\r\n"]},"metadata":{},"sourceType":"script"}